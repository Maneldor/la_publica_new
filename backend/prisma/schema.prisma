generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id                                         String                    @id @default(cuid())
  email                                      String                    @unique
  name                                       String?
  image                                      String?
  role                                       UserRole                  @default(USER)
  primaryRole                                UserRole?
  communityId                                String?
  isActive                                   Boolean                   @default(true)
  isEmailVerified                            Boolean                   @default(false)
  lastLogin                                  DateTime?
  createdAt                                  DateTime                  @default(now())
  updatedAt                                  DateTime                  @updatedAt
  userType                                   UserType                  @default(EMPLOYEE)
  ownedCompanyId                             String?                   @unique
  memberCompanyId                            String?
  companyRole                                CompanyRole?
  cargo                                      String?
  password                                   String?
  Anuncio                                    Anuncio[]
  AnuncioComment                             AnuncioComment[]
  Offer_Offer_approvedByToUser               Offer[]                   @relation("Offer_approvedByToUser")
  Offer_Offer_rejectedByToUser               Offer[]                   @relation("Offer_rejectedByToUser")
  Comunidad                                  Comunidad?                @relation(fields: [communityId], references: [id])
  companies_User_memberCompanyIdTocompanies  companies?                @relation("User_memberCompanyIdTocompanies", fields: [memberCompanyId], references: [id])
  companies_User_ownedCompanyIdTocompanies   companies?                @relation("User_ownedCompanyIdTocompanies", fields: [ownedCompanyId], references: [id])
  audit_logs                                 audit_logs[]
  companies_companies_accountManagerIdToUser companies[]               @relation("companies_accountManagerIdToUser")
  companies_companies_approvedByIdToUser     companies[]               @relation("companies_approvedByIdToUser")
  companies_companies_lastReviewedByIdToUser companies[]               @relation("companies_lastReviewedByIdToUser")
  companies_companies_rejectedByIdToUser     companies[]               @relation("companies_rejectedByIdToUser")
  company_leads                              company_leads[]
  coupons                                    coupons[]
  email_logs                                 email_logs[]
  group_offer_requests                       GroupOfferRequest[]
  groupParticipations                        GroupParticipant[]        @relation("UserGroupParticipations")
  invoices                                   invoices[]
  lead_activities                            lead_activities[]
  lead_documents                             lead_documents[]
  lead_interactions                          lead_interactions[]
  lead_tasks                                 lead_tasks[]
  leads                                      leads[]
  notification_preferences                   notification_preferences?
  notifications_notifications_senderIdToUser notifications[]           @relation("notifications_senderIdToUser")
  notifications_notifications_userIdToUser   notifications[]           @relation("notifications_userIdToUser")
  offer_events                               offer_events[]
  payments                                   payments[]
  redemptions                                redemptions[]
  task_activities                            task_activities[]
  task_attachments                           task_attachments[]
  task_comments                              task_comments[]
  tasks_tasks_assignedToIdToUser             tasks[]                   @relation("tasks_assignedToIdToUser")
  tasks_tasks_createdByIdToUser              tasks[]                   @relation("tasks_createdByIdToUser")
  user_favorites                             user_favorites[]
  user_wallets                               user_wallets?
  announcements                              announcement[]
  announcementReads                          announcementRead[]
  companyRatings                             companyRating[]

  @@index([email])
  @@index([createdAt])
  @@index([isActive, createdAt])
  @@index([communityId])
  @@index([memberCompanyId])
  @@index([ownedCompanyId])
  @@index([role])
  @@index([userType])
}

model PlanConfig {
  id                String          @id @default(cuid())
  planType          String          @unique
  nombre            String
  nombreCorto       String
  descripcion       String
  precioMensual     Float
  precioAnual       Float?
  limitesJSON       String
  caracteristicas   String
  color             String
  icono             String
  orden             Int             @default(0)
  destacado         Boolean         @default(false)
  activo            Boolean         @default(true)
  visible           Boolean         @default(true)
  esSistema         Boolean         @default(false)
  createdAt         DateTime        @default(now())
  updatedAt         DateTime        @updatedAt
  displayNote       String?         @default("IVA incluido")
  priceIncludesVAT  Boolean         @default(true)
  badge             String?
  badgeColor        String?
  basePrice         Float
  description       String?
  durationMonths    Int             @default(12)
  features          Json
  firstYearDiscount Float           @default(0)
  hasFreeTrial      Boolean         @default(false)
  isActive          Boolean         @default(true)
  isDefault         Boolean         @default(false)
  isPioneer         Boolean         @default(false)
  isVisible         Boolean         @default(true)
  maxActiveOffers   Int?
  maxFeaturedOffers Int             @default(0)
  maxStorage        Int?
  maxTeamMembers    Int             @default(1)
  name              String
  nameEn            String?
  nameEs            String?
  priority          Int             @default(0)
  slug              String          @unique
  tier              PlanTier
  trialDurationDays Int?
  funcionalidades   String?
  budget_items      budget_items[]
  companies         companies[]
  invoice_items     invoice_items[]
  subscriptions     subscriptions[]

  @@index([planType])
  @@index([activo, visible])
  @@index([orden])
  @@index([priority])
  @@index([slug])
  @@index([tier])
  @@map("plan_configs")
}

model Offer {
  id                          String                @id @default(cuid())
  title                       String
  slug                        String                @unique
  shortDescription            String?
  description                 String
  images                      String[]              @default([])
  price                       Decimal?              @db.Decimal(10, 2)
  originalPrice               Decimal?              @db.Decimal(10, 2)
  currency                    String                @default("EUR")
  priceType                   PriceType             @default(FIXED)
  companyId                   String
  categoryId                  String
  status                      OfferStatus           @default(DRAFT)
  publishedAt                 DateTime?
  expiresAt                   DateTime?
  approvedAt                  DateTime?
  approvedBy                  String?
  rejectedAt                  DateTime?
  rejectedBy                  String?
  rejectedReason              String?
  submittedAt                 DateTime?
  priority                    Int                   @default(0)
  featured                    Boolean               @default(false)
  featuredUntil               DateTime?
  contactMethod               ContactMethod         @default(EMAIL)
  contactEmail                String?
  contactPhone                String?
  contactForm                 String?
  externalUrl                 String?
  requirements                String?
  benefits                    String?
  duration                    String?
  location                    String?
  remote                      Boolean               @default(false)
  tags                        String[]              @default([])
  views                       Int                   @default(0)
  clicks                      Int                   @default(0)
  applications                Int                   @default(0)
  shares                      Int                   @default(0)
  lastViewedAt                DateTime?
  seoTitle                    String?
  seoDescription              String?
  seoKeywords                 String[]              @default([])
  internalNotes               String?
  createdAt                   DateTime              @default(now())
  updatedAt                   DateTime              @updatedAt
  redemptionType              RedemptionType        @default(COUPON)
  User_Offer_approvedByToUser User?                 @relation("Offer_approvedByToUser", fields: [approvedBy], references: [id])
  OfferCategory               OfferCategory         @relation(fields: [categoryId], references: [id])
  company                     companies             @relation(fields: [companyId], references: [id], onDelete: Cascade)
  User_Offer_rejectedByToUser User?                 @relation("Offer_rejectedByToUser", fields: [rejectedBy], references: [id])
  coupons                     coupons[]
  leads                       leads[]
  offer_events                offer_events[]
  redemptions                 redemptions[]
  user_favorites              user_favorites[]
  wallet_transactions         wallet_transactions[]

  @@index([status])
  @@index([categoryId, status])
  @@index([companyId, status])
  @@index([createdAt])
  @@index([expiresAt])
  @@index([featured, featuredUntil])
  @@index([priority])
  @@index([slug])
  @@index([status, publishedAt])
}

model GroupOfferRequest {
  id                  String            @id @default(cuid())
  title               String
  description         String
  category            String?
  location            String?
  minParticipants     Int
  maxParticipants     Int?
  targetPrice         Decimal?          @db.Decimal(10, 2)
  status              RequestStatus     @default(PENDING)
  publishedAt         DateTime?
  expiresAt           DateTime?
  requesterId         String
  contactEmail        String?
  contactPhone        String?
  reviewedAt          DateTime?
  reviewedBy          String?
  rejectionReason     String?
  groupOfferId        String?           @unique
  tags                String[]          @default([])
  priority            Int               @default(0)
  internalNotes       String?
  createdAt           DateTime          @default(now())
  updatedAt           DateTime          @updatedAt
  group_offer_configs GroupOfferConfig? @relation(fields: [groupOfferId], references: [id])
  User                User              @relation(fields: [requesterId], references: [id], onDelete: Cascade)

  @@index([category])
  @@index([createdAt])
  @@index([expiresAt])
  @@index([requesterId])
  @@index([status])
  @@map("group_offer_requests")
}

model GroupOfferConfig {
  id                   String             @id @default(cuid())
  title                String
  slug                 String             @unique
  description          String
  shortDescription     String?
  images               String[]           @default([])
  category             String?
  tags                 String[]           @default([])
  minParticipants      Int
  maxParticipants      Int
  currentCount         Int                @default(0)
  originalPrice        Decimal            @db.Decimal(10, 2)
  groupPrice           Decimal            @db.Decimal(10, 2)
  savingsAmount        Decimal            @db.Decimal(10, 2)
  savingsPercent       Float
  requiresDeposit      Boolean            @default(false)
  depositAmount        Decimal?           @db.Decimal(10, 2)
  depositPercent       Float?
  registrationStart    DateTime           @default(now())
  registrationEnd      DateTime
  serviceStart         DateTime?
  serviceEnd           DateTime?
  status               GroupOfferStatus   @default(DRAFT)
  publishedAt          DateTime?
  completedAt          DateTime?
  cancelledAt          DateTime?
  cancellationReason   String?
  companyId            String
  contactEmail         String?
  contactPhone         String?
  location             String?
  address              String?
  isOnline             Boolean            @default(false)
  meetingUrl           String?
  requirements         String?
  includes             String?
  excludes             String?
  terms                String?
  cancellationPolicy   String?
  refundPolicy         String?
  seoTitle             String?
  seoDescription       String?
  seoKeywords          String[]           @default([])
  priority             Int                @default(0)
  featured             Boolean            @default(false)
  internalNotes        String?
  createdAt            DateTime           @default(now())
  updatedAt            DateTime           @updatedAt
  companies            companies          @relation(fields: [companyId], references: [id], onDelete: Cascade)
  group_offer_requests GroupOfferRequest?
  group_participants   GroupParticipant[]

  @@index([category])
  @@index([companyId])
  @@index([featured])
  @@index([registrationEnd])
  @@index([serviceStart])
  @@index([slug])
  @@index([status])
  @@map("group_offer_configs")
}

model GroupParticipant {
  id                  String            @id @default(cuid())
  groupOfferId        String
  userId              String
  status              ParticipantStatus @default(PENDING)
  joinedAt            DateTime          @default(now())
  confirmedAt         DateTime?
  completedAt         DateTime?
  cancelledAt         DateTime?
  cancellationReason  String?
  contactName         String?
  contactEmail        String?
  contactPhone        String?
  specialRequests     String?
  allergies           String?
  emergencyContact    String?
  notes               String?
  totalAmount         Decimal           @db.Decimal(10, 2)
  paidAmount          Decimal           @default(0) @db.Decimal(10, 2)
  pendingAmount       Decimal           @db.Decimal(10, 2)
  registrationPaid    Boolean           @default(false)
  registrationPaidAt  DateTime?
  depositPaid         Boolean           @default(false)
  depositPaidAt       DateTime?
  finalPaid           Boolean           @default(false)
  finalPaidAt         DateTime?
  paymentIds          String[]          @default([])
  invoiceNumbers      String[]          @default([])
  rating              Int?
  feedback            String?
  wouldRecommend      Boolean?
  referredBy          String?
  utmSource           String?
  utmCampaign         String?
  createdAt           DateTime          @default(now())
  updatedAt           DateTime          @updatedAt
  group_offer_configs GroupOfferConfig  @relation(fields: [groupOfferId], references: [id], onDelete: Cascade)
  user                User              @relation("UserGroupParticipations", fields: [userId], references: [id], onDelete: Cascade)

  @@unique([groupOfferId, userId])
  @@index([userId])
  @@index([groupOfferId])
  @@index([joinedAt])
  @@index([status])
  @@map("group_participants")
}

model Anuncio {
  id                   String                @id
  title                String
  content              String
  summary              String?
  type                 AnuncioType
  priority             Int                   @default(5)
  status               AnuncioStatus         @default(DRAFT)
  audience             AudienceType
  targetCommunities    String[]
  targetRoles          String[]
  publishAt            DateTime?
  expiresAt            DateTime?
  sendNotification     Boolean               @default(false)
  notificationChannels NotificationChannel[]
  imageUrl             String?
  attachmentUrl        String?
  externalUrl          String?
  tags                 String[]
  isSticky             Boolean               @default(false)
  allowComments        Boolean               @default(true)
  slug                 String?
  views                Int                   @default(0)
  reactions            Int                   @default(0)
  commentsCount        Int                   @default(0)
  sharesCount          Int                   @default(0)
  communityId          String?
  authorId             String
  createdAt            DateTime              @default(now())
  updatedAt            DateTime
  deletedAt            DateTime?
  User                 User                  @relation(fields: [authorId], references: [id])
  Comunidad            Comunidad?            @relation(fields: [communityId], references: [id], onDelete: Cascade)
  AnuncioComment       AnuncioComment[]
  AnuncioMetrics       AnuncioMetrics?

  @@index([authorId])
  @@index([communityId, status, publishAt])
  @@index([deletedAt])
  @@index([publishAt, expiresAt])
  @@index([slug])
  @@index([type, audience])
}

model AnuncioComment {
  id                   String           @id
  content              String
  isPrivate            Boolean          @default(false)
  attachmentUrl        String?
  parentId             String?
  anuncioId            String
  authorId             String
  status               CommentStatus    @default(PENDING)
  moderatedBy          String?
  moderatedAt          DateTime?
  moderationReason     String?
  createdAt            DateTime         @default(now())
  updatedAt            DateTime
  deletedAt            DateTime?
  Anuncio              Anuncio          @relation(fields: [anuncioId], references: [id], onDelete: Cascade)
  User                 User             @relation(fields: [authorId], references: [id])
  AnuncioComment       AnuncioComment?  @relation("AnuncioCommentToAnuncioComment", fields: [parentId], references: [id])
  other_AnuncioComment AnuncioComment[] @relation("AnuncioCommentToAnuncioComment")

  @@index([anuncioId, status])
  @@index([authorId])
  @@index([parentId])
}

model AnuncioMetrics {
  id                String    @id
  anuncioId         String    @unique
  views             Int       @default(0)
  clicks            Int       @default(0)
  reactions         Int       @default(0)
  comments          Int       @default(0)
  shares            Int       @default(0)
  emailOpens        Int       @default(0)
  emailClicks       Int       @default(0)
  pushOpens         Int       @default(0)
  engagementRate    Float     @default(0)
  lastViewedAt      DateTime?
  lastInteractionAt DateTime?
  createdAt         DateTime  @default(now())
  updatedAt         DateTime
  Anuncio           Anuncio   @relation(fields: [anuncioId], references: [id], onDelete: Cascade)

  @@index([engagementRate])
  @@index([lastViewedAt])
}

model Comunidad {
  id          String    @id
  nombre      String
  descripcion String?
  activa      Boolean   @default(true)
  createdAt   DateTime  @default(now())
  updatedAt   DateTime
  Anuncio     Anuncio[]
  User        User[]

  @@index([activa])
}

model OfferCategory {
  id          String   @id
  name        String   @unique
  slug        String   @unique
  description String?
  icon        String?
  color       String?
  isActive    Boolean  @default(true)
  createdAt   DateTime @default(now())
  updatedAt   DateTime
  Offer       Offer[]

  @@index([isActive])
  @@index([slug])
}

model audit_logs {
  id           String      @id
  userId       String
  userName     String
  userEmail    String
  userRole     String
  action       AuditAction
  entity       String
  entityId     String?
  entityName   String?
  description  String
  changes      Json?
  metadata     Json?
  ipAddress    String?
  userAgent    String?
  severity     LogSeverity @default(INFO)
  success      Boolean     @default(true)
  errorMessage String?
  createdAt    DateTime    @default(now())
  User         User        @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([action], map: "idx_auditlog_action")
  @@index([createdAt], map: "idx_auditlog_created")
  @@index([entity], map: "idx_auditlog_entity")
  @@index([entityId], map: "idx_auditlog_entity_id")
  @@index([severity], map: "idx_auditlog_severity")
  @@index([userId], map: "idx_auditlog_user")
}

model budget_items {
  id              String         @id
  budgetId        String
  order           Int            @default(0)
  itemType        BudgetItemType
  planId          String?
  extraId         String?
  description     String
  quantity        Decimal        @default(1) @db.Decimal(10, 2)
  unitPrice       Decimal        @db.Decimal(10, 2)
  discountPercent Decimal?       @db.Decimal(5, 2)
  subtotal        Decimal        @db.Decimal(10, 2)
  billingCycle    BillingCycle?
  createdAt       DateTime       @default(now())
  budgets         budgets        @relation(fields: [budgetId], references: [id], onDelete: Cascade)
  extras          extras?        @relation(fields: [extraId], references: [id])
  plan_configs    PlanConfig?    @relation(fields: [planId], references: [id])

  @@index([budgetId])
}

model budgets {
  id             String         @id
  budgetNumber   String         @unique
  companyId      String
  issueDate      DateTime       @default(now())
  validUntil     DateTime
  approvedAt     DateTime?
  rejectedAt     DateTime?
  status         BudgetStatus   @default(DRAFT)
  subtotal       Decimal        @db.Decimal(10, 2)
  taxRate        Decimal        @default(21.00) @db.Decimal(5, 2)
  taxAmount      Decimal        @db.Decimal(10, 2)
  discountAmount Decimal?       @db.Decimal(10, 2)
  total          Decimal        @db.Decimal(10, 2)
  clientName     String
  clientEmail    String
  clientPhone    String?
  clientNIF      String?
  invoiceId      String?        @unique
  notes          String?
  internalNotes  String?
  terms          String?
  createdAt      DateTime       @default(now())
  updatedAt      DateTime
  createdBy      String?
  budget_items   budget_items[]
  companies      companies      @relation(fields: [companyId], references: [id], onDelete: Cascade)
  invoices       invoices?      @relation(fields: [invoiceId], references: [id])

  @@index([budgetNumber])
  @@index([companyId])
  @@index([status])
}

model companies {
  id                                    String                    @id @default(cuid())
  name                                  String
  cif                                   String?                   @unique
  email                                 String
  phone                                 String?
  address                               String?
  logo                                  String?
  description                           String?
  website                               String?
  socialMedia                           Json?
  certifications                        Json?
  configuration                         Json?
  tags                                  String[]                  @default([])
  userId                                String?
  size                                  String?
  sector                                String?
  logoUrl                               String?
  foundingYear                          Int?
  employeeCount                         Int?
  annualRevenue                         Decimal?                  @db.Decimal(15, 2)
  currentPlanId                         String?
  accountManagerId                      String?
  isActive                              Boolean                   @default(true)
  isVerified                            Boolean                   @default(false)
  createdAt                             DateTime                  @default(now())
  updatedAt                             DateTime                  @updatedAt
  approvedAt                            DateTime?
  approvedById                          String?
  lastReviewedAt                        DateTime?
  lastReviewedById                      String?
  rejectedAt                            DateTime?
  rejectedById                          String?
  rejectionReason                       String?
  status                                CompanyStatus             @default(PENDING)
  offers                                Offer[]
  User_User_memberCompanyIdTocompanies  User[]                    @relation("User_memberCompanyIdTocompanies")
  User_User_ownedCompanyIdTocompanies   User?                     @relation("User_ownedCompanyIdTocompanies")
  budgets                               budgets[]
  User_companies_accountManagerIdToUser User?                     @relation("companies_accountManagerIdToUser", fields: [accountManagerId], references: [id])
  User_companies_approvedByIdToUser     User?                     @relation("companies_approvedByIdToUser", fields: [approvedById], references: [id])
  plan_configs                          PlanConfig?               @relation(fields: [currentPlanId], references: [id])
  User_companies_lastReviewedByIdToUser User?                     @relation("companies_lastReviewedByIdToUser", fields: [lastReviewedById], references: [id])
  User_companies_rejectedByIdToUser     User?                     @relation("companies_rejectedByIdToUser", fields: [rejectedById], references: [id])
  company_leads                         company_leads?
  company_profile_changes               company_profile_changes[]
  coupons                               coupons[]
  group_offer_configs                   GroupOfferConfig[]
  invoices                              invoices[]
  leads                                 leads[]
  offer_events                          offer_events[]
  redemptions                           redemptions[]
  subscriptions                         subscriptions[]
  tasks                                 tasks[]
  companyServices                       companyService[]
  companyProducts                       companyProduct[]
  companyAdvisories                     companyAdvisory[]
  companyRatings                        companyRating[]

  contacts                              contact[]
  notifications                         notifications[]

  @@index([accountManagerId])
  @@index([cif])
  @@index([createdAt])
  @@index([currentPlanId])
  @@index([isActive])
  @@index([status])
  @@index([status, isActive])
}

model company_leads {
  id                   String              @id
  companyName          String
  cif                  String?
  sector               String?
  industry             String?
  contactName          String?
  contactRole          String?
  email                String?
  phone                String?
  website              String?
  address              String?
  city                 String?
  state                String?
  country              String?
  zipCode              String?
  description          String?
  linkedinProfile      String?
  twitterProfile       String?
  facebookProfile      String?
  estimatedSize        String?
  employeeCount        Int?
  employees            Int?
  estimatedValue       Decimal?            @db.Decimal(10, 2)
  sourceId             String?
  userId               String?
  generationMethod     String?
  rawData              Json?
  stage                String?
  confidence           Float?
  scrapedAt            DateTime?
  reviewStatus         String?
  segment              String?
  classifiedAt         DateTime?
  validatedAt          DateTime?
  aiProviderId         String?
  companySize          String?
  estimatedRevenue     Decimal?            @db.Decimal(10, 2)
  currentPlatforms     Json?
  competitorOffers     Json?
  discountTypes        Json?
  status               LeadStatus          @default(NEW)
  priority             LeadPriority        @default(MEDIUM)
  score                Int?
  scoreGrade           String?
  source               LeadSource
  assignedToId         String?
  lastContactDate      DateTime?
  nextFollowUpDate     DateTime?
  convertedToCompanyId String?             @unique
  convertedAt          DateTime?
  tags                 String[]
  notes                String?
  internalNotes        String?
  lostReason           String?

  // AI Processing fields
  aiProcessingStatus   String?             // 'PENDING', 'PROCESSING', 'COMPLETED', 'FAILED'
  aiScore             Int?                // AI-generated score 0-100
  aiScoreReasoning    String?             // Explanation of AI score
  aiInsights          Json?               // AI-generated insights

  // Data Quality fields
  dataQualityScore    Int?                // Data quality score 0-100
  qualityScore        Int?                // Overall quality score

  // Conversion fields
  conversionProbability Float?            // Probability of conversion 0-1

  // Pitch & Marketing fields
  suggestedPitch      String?             // AI-generated pitch
  targetAudience      String?             // Target audience description
  pitchGeneratedAt    DateTime?           // When pitch was generated

  // Validation fields
  validationStatus    String?             // Validation status
  aiSummary          String?             // AI-generated summary

  // Timestamps
  lastAiProcessed     DateTime?           // Last time AI processed this lead

  createdAt            DateTime            @default(now())
  updatedAt            DateTime            @updatedAt
  User                 User?               @relation(fields: [assignedToId], references: [id])
  companies            companies?          @relation(fields: [convertedToCompanyId], references: [id])
  lead_activities      lead_activities[]
  lead_documents       lead_documents[]
  lead_interactions    lead_interactions[]
  lead_tasks           lead_tasks[]
  tasks                tasks[]
  contacts             contact[]
  notifications        notifications[]

  @@index([assignedToId])
  @@index([convertedAt])
  @@index([createdAt])
  @@index([score])
  @@index([source])
  @@index([status, createdAt])

  @@index([status])
  @@index([aiProcessingStatus])
  @@index([aiScore])
  @@index([dataQualityScore])
  @@index([lastAiProcessed])
}

// Extend User with assignedToUser relation
// Note: Add this relation to User model later

model company_profile_changes {
  id              String              @id
  companyId       String
  type            ProfileChangeType
  status          ProfileChangeStatus @default(PENDING)
  oldValue        Json?
  newValue        Json?
  description     String?
  requestedById   String
  approvedById    String?
  rejectedById    String?
  rejectionReason String?
  createdAt       DateTime            @default(now())
  reviewedAt      DateTime?
  companies       companies           @relation(fields: [companyId], references: [id], onDelete: Cascade)

  @@index([companyId, status])
  @@index([createdAt])
  @@index([type, status])
}

model coupons {
  id                  String                @id
  code                String                @unique
  offerId             String
  userId              String
  companyId           String
  qrCodeUrl           String?
  qrCodeData          String?
  status              CouponStatus          @default(ACTIVE)
  generatedAt         DateTime              @default(now())
  expiresAt           DateTime
  usedAt              DateTime?
  cancelledAt         DateTime?
  userAgent           String?
  ipAddress           String?
  deviceType          String?
  generatedFrom       String?
  notes               String?
  companies           companies             @relation(fields: [companyId], references: [id], onDelete: Cascade)
  Offer               Offer                 @relation(fields: [offerId], references: [id], onDelete: Cascade)
  User                User                  @relation(fields: [userId], references: [id], onDelete: Cascade)
  redemptions         redemptions?
  wallet_transactions wallet_transactions[]

  @@index([status])
  @@index([code], map: "idx_coupon_code")
  @@index([companyId], map: "idx_coupon_company")
  @@index([expiresAt], map: "idx_coupon_expires")
  @@index([generatedAt], map: "idx_coupon_generated")
  @@index([offerId], map: "idx_coupon_offer")
  @@index([status], map: "idx_coupon_status")
  @@index([userId], map: "idx_coupon_user")
}

model email_logs {
  id           String        @id
  userId       String
  templateType EmailTemplate
  subject      String
  toEmail      String
  fromEmail    String        @default("noreply@lapublica.es")
  status       EmailStatus   @default(PENDING)
  sentAt       DateTime?
  deliveredAt  DateTime?
  openedAt     DateTime?
  clickedAt    DateTime?
  bouncedAt    DateTime?
  errorMessage String?
  externalId   String?
  metadata     Json?
  createdAt    DateTime      @default(now())
  User         User          @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([externalId])
  @@index([sentAt])
  @@index([status])
  @@index([templateType])
  @@index([toEmail])
  @@index([userId])
}

model extras {
  id               String          @id
  name             String
  slug             String          @unique
  description      String
  category         ExtraCategory
  basePrice        Decimal         @db.Decimal(10, 2)
  priceType        PriceType
  active           Boolean         @default(true)
  featured         Boolean         @default(false)
  requiresApproval Boolean         @default(false)
  icon             String?
  image            String?
  details          Json?
  order            Int             @default(0)
  createdAt        DateTime        @default(now())
  updatedAt        DateTime
  displayNote      String?         @default("IVA incluido")
  priceIncludesVAT Boolean         @default(true)
  budget_items     budget_items[]
  invoice_items    invoice_items[]

  @@index([active])
  @@index([category])
  @@index([slug])
}

model invoice_items {
  id              String          @id
  invoiceId       String
  description     String
  concept         String?
  quantity        Float           @default(1.0)
  unitPrice       Int
  discountPercent Float?
  discountAmount  Int?
  subtotalAmount  Int
  taxRate         Float           @default(21.0)
  taxAmount       Int
  totalAmount     Int
  order           Int             @default(0)
  notes           String?
  createdAt       DateTime        @default(now())
  updatedAt       DateTime
  extraId         String?
  isProrated      Boolean         @default(false)
  itemType        InvoiceItemType @default(CUSTOM)
  planId          String?
  proratedDays    Int?
  extras          extras?         @relation(fields: [extraId], references: [id])
  invoices        invoices        @relation(fields: [invoiceId], references: [id], onDelete: Cascade)
  plan_configs    PlanConfig?     @relation(fields: [planId], references: [id])

  @@index([invoiceId])
  @@index([order])
}

model invoices {
  id               String          @id
  invoiceNumber    String          @unique
  invoiceSeries    String          @default("A")
  companyId        String
  subscriptionId   String?
  status           InvoiceStatus   @default(DRAFT)
  issueDate        DateTime        @default(now())
  dueDate          DateTime
  paidDate         DateTime?
  periodStart      DateTime?
  periodEnd        DateTime?
  issuerName       String          @default("La Pública Servicios Digitales S.L.")
  issuerCif        String          @default("B12345678")
  issuerAddress    String          @default("Calle Ejemplo 123, 08001 Barcelona")
  issuerEmail      String          @default("facturacion@lapublica.es")
  issuerPhone      String?         @default("933123456")
  clientName       String
  clientCif        String
  clientEmail      String
  clientAddress    String
  clientPhone      String?
  clientCity       String?
  clientPostalCode String?
  clientCountry    String          @default("España")
  concept          String
  notes            String?
  subtotalAmount   Int
  taxAmount        Int
  totalAmount      Int
  taxRate          Float           @default(21.0)
  taxType          String          @default("IVA")
  discountPercent  Float?
  discountAmount   Int?
  paidAmount       Int             @default(0)
  pendingAmount    Int
  legalText        String          @default("Esta factura se emite conforme a la Ley 37/1992 del IVA y RD 1619/2012 de facturas")
  retentionPercent Float?
  retentionAmount  Int?
  pdfUrl           String?
  xmlUrl           String?
  createdById      String?
  createdAt        DateTime        @default(now())
  updatedAt        DateTime
  invoiceType      InvoiceType     @default(REGULAR)
  pricesIncludeVAT Boolean         @default(true)
  budgets          budgets?
  invoice_items    invoice_items[]
  companies        companies       @relation(fields: [companyId], references: [id])
  User             User?           @relation(fields: [createdById], references: [id])
  subscriptions    subscriptions?  @relation(fields: [subscriptionId], references: [id])
  payments         payments[]

  @@index([clientCif])
  @@index([companyId, status])
  @@index([dueDate])
  @@index([invoiceNumber])
  @@index([issueDate])
  @@index([status])
}

model lead_activities {
  id            String        @id
  leadId        String
  userId        String?
  type          String
  description   String
  metadata      Json?
  createdAt     DateTime      @default(now())
  company_leads company_leads @relation(fields: [leadId], references: [id], onDelete: Cascade)
  User          User?         @relation(fields: [userId], references: [id])

  @@index([createdAt])
  @@index([leadId])
}

model lead_documents {
  id            String        @id
  leadId        String
  userId        String
  name          String
  fileUrl       String
  fileType      String
  fileSize      Int
  uploadedAt    DateTime      @default(now())
  company_leads company_leads @relation(fields: [leadId], references: [id], onDelete: Cascade)
  User          User          @relation(fields: [userId], references: [id])

  @@index([leadId])
}

model lead_interactions {
  id                    String          @id
  leadId                String
  userId                String
  contactId             String?
  type                  InteractionType
  title                 String?
  description           String
  outcome               String?
  duration              Int?
  nextAction            String?
  nextActionCompleted   Boolean?        @default(false)
  nextActionDate        DateTime?
  metadata              Json?
  createdAt             DateTime        @default(now())
  company_leads         company_leads   @relation(fields: [leadId], references: [id], onDelete: Cascade)
  createdBy             User            @relation(fields: [userId], references: [id])
  contact               contact?        @relation(fields: [contactId], references: [id], onDelete: SetNull)

  @@index([createdAt])
  @@index([leadId])
  @@index([userId])
}

model lead_tasks {
  id            String         @id
  leadId        String?
  userId        String
  title         String
  description   String?
  dueDate       DateTime?
  priority      LeadPriority   @default(MEDIUM)
  status        TaskStatus     @default(PENDING)
  completedAt   DateTime?
  createdAt     DateTime       @default(now())
  updatedAt     DateTime
  company_leads company_leads? @relation(fields: [leadId], references: [id])
  User          User           @relation(fields: [userId], references: [id])

  @@index([dueDate])
  @@index([leadId])
  @@index([status])
  @@index([userId])
}

model leads {
  id        String    @id
  offerId   String
  userId    String
  companyId String
  name      String
  email     String
  phone     String?
  message   String?
  status    String    @default("NEW")
  metadata  Json?
  createdAt DateTime  @default(now())
  updatedAt DateTime
  companies companies @relation(fields: [companyId], references: [id], onDelete: Cascade)
  Offer     Offer     @relation(fields: [offerId], references: [id], onDelete: Cascade)
  User      User      @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([companyId])
  @@index([createdAt])
  @@index([offerId])
  @@index([status])
  @@index([userId])
}

model notification_preferences {
  id                   String   @id
  userId               String   @unique
  emailEnabled         Boolean  @default(true)
  emailCouponGenerated Boolean  @default(true)
  emailCouponUsed      Boolean  @default(true)
  emailOfferExpiring   Boolean  @default(true)
  emailNewFavorite     Boolean  @default(true)
  emailWeeklySummary   Boolean  @default(true)
  inAppEnabled         Boolean  @default(true)
  inAppCouponGenerated Boolean  @default(true)
  inAppCouponUsed      Boolean  @default(true)
  inAppOfferExpiring   Boolean  @default(true)
  inAppNewFavorite     Boolean  @default(true)
  inAppWeeklySummary   Boolean  @default(false)
  weeklySummaryDay     Int      @default(1)
  weeklySummaryHour    Int      @default(9)
  timezone             String   @default("Europe/Madrid")
  createdAt            DateTime @default(now())
  updatedAt            DateTime
  User                 User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
}

model notifications {
  id                                String               @id
  title                             String
  message                           String
  type                              NotificationType
  priority                          NotificationPriority @default(NORMAL)
  isRead                            Boolean              @default(false)
  userId                            String
  senderId                          String?
  companyId                         String?
  leadId                            String?
  actionType                        String?
  actionUrl                         String?
  dueDate                           DateTime?
  metadata                          Json?
  createdAt                         DateTime             @default(now())
  readAt                            DateTime?
  User_notifications_senderIdToUser User?                @relation("notifications_senderIdToUser", fields: [senderId], references: [id])
  User_notifications_userIdToUser   User                 @relation("notifications_userIdToUser", fields: [userId], references: [id], onDelete: Cascade)
  company                           companies?           @relation(fields: [companyId], references: [id], onDelete: Cascade)
  lead                              company_leads?       @relation(fields: [leadId], references: [id], onDelete: Cascade)

  @@index([createdAt])
  @@index([isRead])
  @@index([type, priority])
  @@index([userId, isRead])
}

model offer_events {
  id          String    @id
  offerId     String
  userId      String?
  companyId   String
  eventType   EventType
  sessionId   String?
  userAgent   String?
  ipAddress   String?
  deviceType  String?
  browser     String?
  os          String?
  referrer    String?
  utmSource   String?
  utmMedium   String?
  utmCampaign String?
  country     String?
  city        String?
  region      String?
  latitude    Float?
  longitude   Float?
  duration    Int?
  scrollDepth Int?
  createdAt   DateTime  @default(now())
  companies   companies @relation(fields: [companyId], references: [id], onDelete: Cascade)
  Offer       Offer     @relation(fields: [offerId], references: [id], onDelete: Cascade)
  User        User?     @relation(fields: [userId], references: [id])

  @@index([companyId], map: "idx_event_company")
  @@index([createdAt], map: "idx_event_created")
  @@index([offerId, eventType], map: "idx_event_offer_type")
  @@index([sessionId], map: "idx_event_session")
  @@index([eventType], map: "idx_event_type")
  @@index([userId], map: "idx_event_user")
  @@index([eventType, createdAt])
}

model payments {
  id              String        @id
  invoiceId       String
  paymentNumber   String        @unique
  reference       String?
  externalId      String?
  method          PaymentMethod
  status          PaymentStatus @default(PENDING)
  amount          Int
  feeAmount       Int?
  netAmount       Int
  paymentDate     DateTime      @default(now())
  processedDate   DateTime?
  settledDate     DateTime?
  paymentDetails  Json?
  description     String?
  notes           String?
  processedById   String?
  createdAt       DateTime      @default(now())
  updatedAt       DateTime
  stripePaymentId String?       @unique
  stripeSessionId String?       @unique
  invoices        invoices      @relation(fields: [invoiceId], references: [id])
  User            User?         @relation(fields: [processedById], references: [id])

  @@index([invoiceId])
  @@index([method])
  @@index([paymentDate])
  @@index([paymentNumber])
  @@index([status])
}

model redemptions {
  id                 String    @id
  couponId           String    @unique
  offerId            String
  userId             String
  companyId          String
  redeemedAt         DateTime  @default(now())
  redemptionType     String    @default("in_store")
  channel            String?
  location           String?
  storeId            String?
  originalPrice      Decimal?  @db.Decimal(10, 2)
  discountAmount     Decimal?  @db.Decimal(10, 2)
  finalPrice         Decimal?  @db.Decimal(10, 2)
  currency           String    @default("EUR")
  validatedBy        String?
  validatedAt        DateTime  @default(now())
  verificationMethod String?
  userAgent          String?
  ipAddress          String?
  deviceType         String?
  notes              String?
  customerNotes      String?
  receiptNumber      String?
  rating             Int?
  feedback           String?
  companies          companies @relation(fields: [companyId], references: [id], onDelete: Cascade)
  coupons            coupons   @relation(fields: [couponId], references: [id], onDelete: Cascade)
  Offer              Offer     @relation(fields: [offerId], references: [id], onDelete: Cascade)
  User               User      @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([companyId], map: "idx_redemption_company")
  @@index([redeemedAt], map: "idx_redemption_date")
  @@index([offerId], map: "idx_redemption_offer")
  @@index([redemptionType], map: "idx_redemption_type")
  @@index([userId], map: "idx_redemption_user")
}

model subscriptions {
  id            String             @id
  companyId     String
  planId        String
  status        SubscriptionStatus @default(ACTIVE)
  precioMensual Float
  precioAnual   Float?
  limites       Json
  startDate     DateTime           @default(now())
  endDate       DateTime?
  cancelledAt   DateTime?
  isAutoRenew   Boolean            @default(true)
  extras        Json?
  createdAt     DateTime           @default(now())
  updatedAt     DateTime
  invoices      invoices[]
  companies     companies          @relation(fields: [companyId], references: [id], onDelete: Cascade)
  plan_configs  PlanConfig         @relation(fields: [planId], references: [id])

  @@index([companyId])
  @@index([endDate])
  @@index([planId])
  @@index([status])
}

model task_activities {
  id          String             @id
  taskId      String
  userId      String?
  action      TaskActivityAction
  description String
  metadata    Json?
  createdAt   DateTime           @default(now())
  tasks       tasks              @relation(fields: [taskId], references: [id], onDelete: Cascade)
  User        User?              @relation(fields: [userId], references: [id])

  @@index([createdAt])
  @@index([taskId])
}

model task_attachments {
  id           String   @id
  taskId       String
  fileName     String
  fileUrl      String
  fileSize     Int
  mimeType     String
  uploadedById String
  createdAt    DateTime @default(now())
  tasks        tasks    @relation(fields: [taskId], references: [id], onDelete: Cascade)
  User         User     @relation(fields: [uploadedById], references: [id])

  @@index([taskId])
}

model task_comments {
  id        String   @id
  taskId    String
  userId    String
  content   String
  mentions  String[]
  createdAt DateTime @default(now())
  updatedAt DateTime
  tasks     tasks    @relation(fields: [taskId], references: [id], onDelete: Cascade)
  User      User     @relation(fields: [userId], references: [id])

  @@index([taskId])
}

model tasks {
  id                                    String             @id
  title                                 String
  description                           String?
  type                                  TaskType
  status                                TaskStatus         @default(PENDING)
  priority                              TaskPriority
  category                              TaskCategory?
  assignedToId                          String
  createdById                           String
  leadId                                String?
  companyId                             String?
  dueDate                               DateTime?
  startDate                             DateTime?
  completedAt                           DateTime?
  estimatedMinutes                      Int?
  actualMinutes                         Int?
  reminderDate                          DateTime?
  reminderSent                          Boolean            @default(false)
  isRecurring                           Boolean            @default(false)
  recurrenceRule                        String?
  parentRecurringId                     String?
  urgencyScore                          Int                @default(0)
  impactScore                           Int                @default(0)
  effortScore                           Int                @default(0)
  autoScore                             Int                @default(0)
  parentTaskId                          String?
  tags                                  String[]
  customFields                          Json?
  createdAt                             DateTime           @default(now())
  updatedAt                             DateTime
  task_activities                       task_activities[]
  task_attachments                      task_attachments[]
  task_comments                         task_comments[]
  User_tasks_assignedToIdToUser         User               @relation("tasks_assignedToIdToUser", fields: [assignedToId], references: [id])
  companies                             companies?         @relation(fields: [companyId], references: [id], onDelete: Cascade)
  User_tasks_createdByIdToUser          User               @relation("tasks_createdByIdToUser", fields: [createdById], references: [id])
  company_leads                         company_leads?     @relation(fields: [leadId], references: [id], onDelete: Cascade)
  tasks_tasks_parentTaskIdTotasks       tasks?             @relation("tasks_parentTaskIdTotasks", fields: [parentTaskId], references: [id], onDelete: Cascade)
  other_tasks_tasks_parentTaskIdTotasks tasks[]            @relation("tasks_parentTaskIdTotasks")
  tasks_TaskDependencies_A              tasks[]            @relation("TaskDependencies")
  tasks_TaskDependencies_B              tasks[]            @relation("TaskDependencies")

  @@index([assignedToId])
  @@index([companyId])
  @@index([dueDate])
  @@index([leadId])
  @@index([priority])
  @@index([status])
}

model user_favorites {
  id        String   @id
  userId    String
  offerId   String
  createdAt DateTime @default(now())
  Offer     Offer    @relation(fields: [offerId], references: [id], onDelete: Cascade)
  User      User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([userId, offerId])
  @@index([createdAt], map: "idx_favorite_created")
  @@index([offerId], map: "idx_favorite_offer")
  @@index([userId], map: "idx_favorite_user")
}

model user_wallets {
  id                  String                @id
  userId              String                @unique
  balance             Decimal               @default(0) @db.Decimal(10, 2)
  currency            String                @default("EUR")
  createdAt           DateTime              @default(now())
  updatedAt           DateTime
  User                User                  @relation(fields: [userId], references: [id], onDelete: Cascade)
  wallet_transactions wallet_transactions[]

  @@index([userId])
}

model wallet_transactions {
  id           String       @id
  walletId     String
  type         String
  amount       Decimal      @db.Decimal(10, 2)
  description  String
  offerId      String?
  couponId     String?
  metadata     Json?
  createdAt    DateTime     @default(now())
  coupons      coupons?     @relation(fields: [couponId], references: [id])
  Offer        Offer?       @relation(fields: [offerId], references: [id])
  user_wallets user_wallets @relation(fields: [walletId], references: [id], onDelete: Cascade)

  @@index([createdAt])
  @@index([offerId])
  @@index([type])
  @@index([walletId])
}

enum PermissionType {
  // Sistema
  MANAGE_USERS
  MANAGE_ROLES
  MANAGE_PERMISSIONS
  VIEW_ADMIN_DASHBOARD
  MANAGE_SYSTEM_CONFIG

  // Contenido
  CREATE_CONTENT
  EDIT_CONTENT
  DELETE_CONTENT
  PUBLISH_CONTENT
  MODERATE_CONTENT
  PIN_CONTENT

  // Posts
  CREATE_POST
  EDIT_POST
  DELETE_POST
  MODERATE_POST
  PIN_POST
  CREATE_COMMENT
  EDIT_COMMENT
  DELETE_COMMENT
  MODERATE_COMMENT

  // Grupos
  CREATE_GROUP
  EDIT_GROUP
  DELETE_GROUP
  MANAGE_GROUP_MEMBERS
  MODERATE_GROUP_CONTENT
  PIN_GROUP_CONTENT

  // Foros
  CREATE_FORUM
  EDIT_FORUM
  DELETE_FORUM
  CREATE_FORUM_TOPIC
  EDIT_FORUM_TOPIC
  DELETE_FORUM_TOPIC
  MODERATE_FORUM
  PIN_FORUM_TOPIC
  LOCK_FORUM_TOPIC

  // Anuncios
  CREATE_ANNOUNCEMENT
  EDIT_ANNOUNCEMENT
  DELETE_ANNOUNCEMENT
  PUBLISH_ANNOUNCEMENT
  PIN_ANNOUNCEMENT

  // Empresas
  MANAGE_COMPANIES
  CREATE_COMPANY_PROFILE
  EDIT_COMPANY_PROFILE
  MANAGE_COMPANY_SERVICES

  // Administraciones
  MANAGE_PUBLIC_ADMINISTRATIONS
  CREATE_ADMIN_PROFILE
  EDIT_ADMIN_PROFILE

  // Moderación
  VIEW_REPORTS
  HANDLE_REPORTS
  VIEW_MODERATION_STATS
  BULK_MODERATE

  // Otros
  IMPERSONATE_USER
  VIEW_AUDIT_LOGS
  MANAGE_TRANSLATIONS
  MANAGE_COMMUNITIES
}

enum UserRole {
  USER
  MODERATOR
  COMMUNITY_MANAGER
  ADMIN
  SUPER_ADMIN
  COMPANY
  COMPANY_MANAGER
  GESTOR_EMPRESAS
  ADMINISTRADOR_GRUPO
  EMPLEADO_PUBLICO
}

enum NotificationType {
  COMPANY_PENDING
  COMPANY_APPROVED
  COMPANY_REJECTED
  PROFILE_CHANGE
  GENERAL
  SYSTEM
  COUPON_GENERATED
  COUPON_USED
  OFFER_EXPIRING
  NEW_FAVORITE
  WEEKLY_SUMMARY
  ALERT
  INFO
  REMINDER
  SUCCESS
}

enum NotificationPriority {
  LOW
  NORMAL
  MEDIUM
  HIGH
  URGENT
}

enum EventType {
  VIEW
  DETAIL_VIEW
  CLICK
  SHARE
  FAVORITE_ADD
  FAVORITE_REMOVE
  COUPON_VIEW
  COUPON_GENERATED
  COUPON_DOWNLOADED
  COUPON_SHARED
  COUPON_USED
  EXTERNAL_CLICK
  CONTACT_CLICK
  PHONE_CLICK
  EMAIL_CLICK
  MAP_VIEW
  GALLERY_VIEW
}

enum GroupOfferStatus {
  DRAFT
  PUBLISHED
  PAUSED
  COMPLETED
  CANCELLED
  EXPIRED
}

enum ParticipantStatus {
  PENDING
  CONFIRMED
  CANCELLED
  COMPLETED
  REFUNDED
}

enum PaymentStage {
  REGISTRATION
  DEPOSIT
  FINAL
  FULL
}

enum RequestStatus {
  PENDING
  APPROVED
  REJECTED
  CANCELLED
}

enum AnuncioStatus {
  DRAFT
  PENDING
  PUBLISHED
  ARCHIVED
  EXPIRED
}

enum AnuncioType {
  GENERAL
  URGENT
  EVENT
  MAINTENANCE
  NEWS
  ALERT
  PROMOTION
  REGULATION
}

enum AudienceType {
  ALL
  EMPLOYEES
  COMPANIES
  SPECIFIC
  COMMUNITY
}

enum AuditAction {
  COMPANY_APPROVED
  COMPANY_REJECTED
  COMPANY_SUSPENDED
  COMPANY_REACTIVATED
  COMPANY_DELETED
  COMPANY_UPDATED
  OFFER_APPROVED
  OFFER_REJECTED
  OFFER_DELETED
  OFFER_FEATURED
  OFFER_UNFEATURED
  OFFER_UPDATED
  USER_CREATED
  USER_UPDATED
  USER_DELETED
  USER_SUSPENDED
  USER_REACTIVATED
  USER_ROLE_CHANGED
  COUPON_CANCELLED
  COUPON_BULK_EXPORT
  SETTINGS_UPDATED
  PLAN_CONFIG_UPDATED
  BULK_ACTION
  LOGIN_ADMIN
  LOGOUT_ADMIN
  PERMISSION_CHANGED
  OTHER
}

enum BillingCycle {
  MONTHLY
  ANNUAL
  ONE_TIME
}

enum BudgetItemType {
  PLAN
  EXTRA
  CUSTOM
  DISCOUNT
}

enum BudgetStatus {
  DRAFT
  SENT
  APPROVED
  REJECTED
  EXPIRED
  INVOICED
}

enum CommentStatus {
  PENDING
  APPROVED
  REJECTED
  HIDDEN
}

enum CompanyRole {
  OWNER
  MEMBER
}

enum CompanyStatus {
  PENDING
  PUBLISHED
  REJECTED
  SUSPENDED
  INACTIVE
}

enum ContactMethod {
  EMAIL
  PHONE
  FORM
  EXTERNAL
  WHATSAPP
}

enum CouponStatus {
  ACTIVE
  USED
  EXPIRED
  CANCELLED
  SUSPENDED
}

enum EmailStatus {
  PENDING
  SENT
  DELIVERED
  OPENED
  CLICKED
  BOUNCED
  FAILED
}

enum EmailTemplate {
  COUPON_GENERATED
  COUPON_USED
  OFFER_EXPIRING
  NEW_FAVORITE
  WEEKLY_SUMMARY
  WELCOME
  PASSWORD_RESET
  EMAIL_VERIFICATION
}

enum ExtraCategory {
  WEB_MAINTENANCE
  BRANDING
  MARKETING
  SEO
  CONTENT
  CONSULTING
  TRAINING
  DEVELOPMENT
  SUPPORT
  OTHER
}

enum InteractionType {
  NOTE
  CALL
  EMAIL
  MEETING
  WHATSAPP
  STATUS_CHANGE
  DOCUMENT
}

enum InvoiceItemType {
  PLAN
  EXTRA
  UPGRADE
  PRORATED
  DISCOUNT
  CUSTOM
}

enum InvoiceStatus {
  DRAFT
  SENT
  PAID
  OVERDUE
  CANCELLED
}

enum InvoiceType {
  REGULAR
  PROFORMA
  RECURRING
  UPGRADE
  ADJUSTMENT
  REFUND
}

enum LeadPriority {
  LOW
  MEDIUM
  HIGH
  URGENT
}

enum LeadSource {
  MANUAL
  WEB_FORM
  AI_PROSPECTING
  REFERRAL
  EMPLOYEE_SUGGESTION
  INBOUND
  COLD_OUTREACH
}

enum AdministrationType {
  LOCAL
  AUTONOMICA
  CENTRAL
}

enum LeadStatus {
  NEW
  PROSPECTING
  CONTACTED
  QUALIFIED
  PROPOSAL_SENT
  NEGOTIATION
  DOCUMENTATION
  WON
  LOST
  ON_HOLD
}

enum LogSeverity {
  INFO
  WARNING
  ERROR
  CRITICAL
}

enum NotificationChannel {
  PLATFORM
  EMAIL
  SMS
  PUSH
  ALL_CHANNELS
}

enum OfferStatus {
  DRAFT
  PENDING
  PUBLISHED
  REJECTED
  PAUSED
  EXPIRED
  ARCHIVED
}

enum PaymentMethod {
  BANK_TRANSFER
  CREDIT_CARD
  DEBIT_CARD
  PAYPAL
  CASH
  CHECK
  SEPA_DIRECT_DEBIT
}

enum PaymentStatus {
  PENDING
  PROCESSING
  COMPLETED
  FAILED
  REFUNDED
  CANCELLED
}

enum PlanTier {
  PIONERES
  STANDARD
  STRATEGIC
  ENTERPRISE
  CUSTOM
}

enum PriceType {
  FIXED
  MONTHLY
  ANNUAL
  HOURLY
  CUSTOM
}

enum ProfileChangeStatus {
  PENDING
  APPROVED
  REJECTED
}

enum ProfileChangeType {
  COMPANY_DATA
  CONTACT_INFO
  LOGO
  DESCRIPTION
  OTHER
}

enum RedemptionType {
  COUPON
  ONLINE
  VIP_ACCOUNT
  CONTACT_FORM
}

enum SubscriptionStatus {
  ACTIVE
  CANCELLED
  EXPIRED
  PENDING
}

enum TaskActivityAction {
  CREATED
  UPDATED
  ASSIGNED
  STATUS_CHANGED
  PRIORITY_CHANGED
  COMMENT_ADDED
  COMPLETED
  REOPENED
  DELETED
  ATTACHMENT_ADDED
}

enum TaskCategory {
  SALES
  MARKETING
  SUPPORT
  OPERATIONS
  ADMIN
  DEVELOPMENT
}

enum TaskPriority {
  URGENT
  HIGH
  MEDIUM
  LOW
}

enum TaskStatus {
  PENDING
  IN_PROGRESS
  COMPLETED
  CANCELLED
}

enum TaskType {
  FOLLOW_UP
  MEETING
  CALL
  EMAIL
  DEMO
  PROPOSAL
  CONTRACT
  ONBOARDING
  SUPPORT
  INTERNAL
  OTHER
}

enum UserType {
  EMPLOYEE
  COMPANY_OWNER
  COMPANY_MEMBER
  ACCOUNT_MANAGER
  ADMIN
}

model announcement {
  id            String              @id @default(cuid())
  title         String
  content       String
  type          String              @default("INFO")
  priority      Int                 @default(0)
  startDate     DateTime?
  endDate       DateTime?
  expiresAt     DateTime?
  isActive      Boolean             @default(true)
  targetAudience String?
  scope         String?
  targets       Json?
  configuration Json?
  isPinned      Boolean             @default(false)
  createdBy     String?
  userId        String?
  status        String              @default("approved")
  isRead        Boolean             @default(false)
  createdAt     DateTime            @default(now())
  updatedAt     DateTime            @updatedAt

  // Relations
  user          User?               @relation(fields: [userId], references: [id])
  reads         announcementRead[]

  @@map("announcements")
}

model aIProvider {
  id                String              @id @default(cuid())
  name              String              @unique
  displayName       String
  type              String
  config            Json
  capabilities      Json?
  isActive          Boolean             @default(true)
  isDefault         Boolean             @default(false)
  totalRequests     Int                 @default(0)
  successfulRequests Int                @default(0)
  failedRequests    Int                @default(0)
  totalCost         Decimal?            @db.Decimal(10, 4)
  averageLatency    Float?
  createdAt         DateTime            @default(now())
  updatedAt         DateTime            @updatedAt

  leadSources       leadSource[]
  aiLogs            aILog[]

  @@map("ai_providers")
}

model aILog {
  id            String              @id @default(cuid())
  providerId    String
  operation     String
  success       Boolean
  latency       Int?
  cost          Decimal?            @db.Decimal(10, 4)
  createdAt     DateTime            @default(now())

  provider      aIProvider          @relation(fields: [providerId], references: [id])

  @@map("ai_logs")
}

model leadSource {
  id                String              @id @default(cuid())
  name              String
  type              String
  searchQuery       String?
  config            Json?
  isActive          Boolean             @default(true)
  frequency         String?
  userId            String
  providerId        String?
  leadsGenerated    Int                 @default(0)
  lastRun           DateTime?
  lastRunLeadsCount Int?
  totalRuns         Int                 @default(0)
  averageLeadsPerRun Float?
  nextRun           DateTime?
  createdAt         DateTime            @default(now())
  updatedAt         DateTime            @updatedAt

  provider          aIProvider?         @relation(fields: [providerId], references: [id])

  @@map("lead_sources")
}

model forum {
  id            String              @id @default(cuid())
  name          String
  title         String?
  description   String?
  slug          String              @unique
  type          String?
  category      String?
  comunidadSlug String?
  configuration Json?
  creatorId     String?
  isPinned      Boolean             @default(false)
  isLocked      Boolean             @default(false)
  isActive      Boolean             @default(true)
  order         Int                 @default(0)
  createdAt     DateTime            @default(now())
  updatedAt     DateTime            @updatedAt

  topics        forumTopic[]

  @@map("forums")
}

model forumTopic {
  id            String              @id @default(cuid())
  forumId       String
  title         String
  content       String
  authorId      String
  views         Int                 @default(0)
  isPinned      Boolean             @default(false)
  isLocked      Boolean             @default(false)
  tags          String[]            @default([])
  lastActivity  DateTime?
  userId        String?
  type          String?
  isActive      Boolean             @default(true)
  createdAt     DateTime            @default(now())
  updatedAt     DateTime            @updatedAt

  forum         forum               @relation(fields: [forumId], references: [id])
  replies       forumReply[]

  @@map("forum_topics")
}

model forumReply {
  id            String              @id @default(cuid())
  topicId       String
  content       String
  authorId      String
  userId        String?
  replyToId     String?
  isAccepted    Boolean             @default(false)
  isActive      Boolean             @default(true)
  createdAt     DateTime            @default(now())
  updatedAt     DateTime            @updatedAt

  topic         forumTopic          @relation(fields: [topicId], references: [id])

  @@map("forum_replies")
}

model groupMember {
  id            String              @id @default(cuid())
  groupId       String
  userId        String
  role          String              @default("MEMBER")
  status        String              @default("ACTIVE")
  joinedAt      DateTime            @default(now())
  updatedAt     DateTime            @updatedAt
  configuration Json?
  tags          String[]            @default([])

  @@unique([groupId, userId])
  @@map("group_members")
}

model groupPost {
  id            String              @id @default(cuid())
  groupId       String
  authorId      String
  content       String
  title         String?
  tags          String[]            @default([])
  multimedia    Json?
  attachments   Json?
  likes         Int                 @default(0)
  comments      Int                 @default(0)
  userId        String?
  isActive      Boolean             @default(true)
  publishedAt   DateTime?
  createdAt     DateTime            @default(now())
  updatedAt     DateTime            @updatedAt

  @@map("group_posts")
}

model customField {
  id            String              @id @default(cuid())
  entityType    String
  entityId      String
  fieldName     String
  fieldValue    Json
  fieldType     String
  isRequired    Boolean             @default(false)
  isActive      Boolean             @default(true)
  order         Int                 @default(0)
  createdAt     DateTime            @default(now())
  updatedAt     DateTime            @updatedAt

  @@index([entityType, entityId])
  @@map("custom_fields")
}

model employee {
  id            String              @id @default(cuid())
  userId        String
  companyId     String?
  nick          String?
  firstName     String?
  lastName      String?
  community     String?
  department    String?
  position      String?
  administrationType AdministrationType?
  avatar        String?
  bio           String?
  socialNetworks Json?
  privacySettings Json?
  startDate     DateTime?
  endDate       DateTime?
  isActive      Boolean             @default(true)
  createdAt     DateTime            @default(now())
  updatedAt     DateTime            @updatedAt

  @@map("employees")
}

model group {
  id            String              @id @default(cuid())
  name          String
  description   String?
  slug          String              @unique
  type          String              @default("PUBLIC")
  isActive      Boolean             @default(true)
  createdBy     String
  creatorId     String?
  configuration Json?
  tags          String[]            @default([])
  createdAt     DateTime            @default(now())
  updatedAt     DateTime            @updatedAt

  @@map("groups")
}

model event {
  id            String              @id @default(cuid())
  title         String
  description   String?
  startDate     DateTime
  endDate       DateTime
  location      String?
  type          String              @default("GENERAL")
  isActive      Boolean             @default(true)
  organizer     String
  capacity      Int?
  configuration Json?
  tags          String[]            @default([])
  createdAt     DateTime            @default(now())
  updatedAt     DateTime            @updatedAt

  @@map("events")
}

model interaction {
  id            String              @id @default(cuid())
  entityType    String
  entityId      String
  userId        String
  type          String
  subject       String?
  content       Json?
  outcome       String?
  metadata      Json?
  companyLeadId String?
  companyId     String?
  contactId     String?
  nextAction    String?
  nextActionDate DateTime?
  createdById   String?
  nextActionCompleted Boolean         @default(false)
  createdAt     DateTime            @default(now())

  @@index([entityType, entityId])
  @@index([userId])
  @@map("interactions")
}

model content {
  id            String              @id @default(cuid())
  title         String
  slug          String              @unique
  type          String              @default("ARTICLE")
  body          String
  excerpt       String?
  author        String
  status        String              @default("DRAFT")
  publishedAt   DateTime?
  tags          String[]            @default([])
  metadata      Json?
  createdAt     DateTime            @default(now())
  updatedAt     DateTime            @updatedAt

  @@map("contents")
}

model course {
  id            String              @id @default(cuid())
  title         String
  description   String?
  instructor    String
  duration      String?
  price         Decimal?            @db.Decimal(10, 2)
  level         String              @default("BEGINNER")
  category      String?
  isActive      Boolean             @default(true)
  tags          String[]            @default([])
  configuration Json?
  createdAt     DateTime            @default(now())
  updatedAt     DateTime            @updatedAt

  @@map("courses")
}

model companyRating {
  id            String              @id @default(cuid())
  companyId     String
  serviceId     String?
  advisoryId    String?
  userId        String
  rating        Int
  comment       String?
  isVerified    Boolean             @default(false)
  isActive      Boolean             @default(true)
  createdAt     DateTime            @default(now())
  updatedAt     DateTime            @updatedAt

  // Relations
  company       companies           @relation(fields: [companyId], references: [id], onDelete: Cascade)
  user          User                @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([companyId, userId])
  @@index([companyId])
  @@index([userId])
  @@map("company_ratings")
}

model forumModerator {
  id            String              @id @default(cuid())
  forumId       String
  userId        String
  permissions   String[]            @default([])
  role          String?
  assignedAt    DateTime            @default(now())
  assignedBy    String
  isActive      Boolean             @default(true)

  @@unique([forumId, userId])
  @@map("forum_moderators")
}

model userNotification {
  id            String              @id @default(cuid())
  userId        String
  title         String
  content       String
  type          String              @default("INFO")
  isRead        Boolean             @default(false)
  data          Json?
  createdAt     DateTime            @default(now())
  updatedAt     DateTime            @updatedAt

  @@index([userId, isRead])
  @@map("user_notifications")
}

model report {
  id            String              @id @default(cuid())
  entityType    String
  entityId      String
  reporterId    String
  reason        String
  description   String?
  status        String              @default("PENDING")
  reviewedBy    String?
  reviewedAt    DateTime?
  resolution    String?
  createdAt     DateTime            @default(now())
  updatedAt     DateTime            @updatedAt

  @@index([entityType, entityId])
  @@index([reporterId])
  @@index([status])
  @@map("reports")
}

model postReport {
  id            String              @id @default(cuid())
  postId        String
  userId        String
  reason        String
  description   String?
  status        String              @default("PENDING")
  moderatedBy   String?
  moderatedAt   DateTime?
  action        String?
  createdAt     DateTime            @default(now())

  @@unique([postId, userId])
  @@map("post_reports")
}

model announcementRead {
  id              String              @id @default(cuid())
  announcementId  String
  userId          String
  readAt          DateTime            @default(now())

  // Relations
  announcement    announcement        @relation(fields: [announcementId], references: [id], onDelete: Cascade)
  user            User                @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([announcementId, userId])
  @@map("announcement_reads")
}

model multimedia {
  id            String              @id @default(cuid())
  type          String
  url           String
  filename      String?
  mimeType      String?
  size          Int?
  entityType    String?
  entityId      String?
  uploadedBy    String
  isPublic      Boolean             @default(true)
  metadata      Json?
  createdAt     DateTime            @default(now())
  updatedAt     DateTime            @updatedAt

  @@index([entityType, entityId])
  @@index([uploadedBy])
  @@map("multimedia")
}

model companyService {
  id            String              @id @default(cuid())
  companyId     String
  name          String
  description   String?
  category      String?
  subcategory   String?
  price         Decimal?            @db.Decimal(10, 2)
  features      Json?
  pricing       Json?
  availability  Json?
  duration      String?
  modality      String?
  order         Int                 @default(0)
  isActive      Boolean             @default(true)
  createdAt     DateTime            @default(now())
  updatedAt     DateTime            @updatedAt

  // Relations
  company       companies           @relation(fields: [companyId], references: [id], onDelete: Cascade)

  @@index([companyId])
  @@map("company_services")
}

model companyProduct {
  id            String              @id @default(cuid())
  companyId     String
  name          String
  description   String?
  category      String?
  subcategory   String?
  price         Decimal?            @db.Decimal(10, 2)
  features      Json?
  images        String[]            @default([])
  stock         Int?
  isAvailable   Boolean             @default(true)
  order         Int                 @default(0)
  isActive      Boolean             @default(true)
  createdAt     DateTime            @default(now())
  updatedAt     DateTime            @updatedAt

  // Relations
  company       companies           @relation(fields: [companyId], references: [id], onDelete: Cascade)

  @@index([companyId])
  @@map("company_products")
}

model companyAdvisory {
  id            String              @id @default(cuid())
  companyId     String
  clientId      String?
  title         String
  subject       String?
  description   String?
  category      String?
  duration      String?
  price         Decimal?            @db.Decimal(10, 2)
  finalBudget   Decimal?            @db.Decimal(10, 2)
  estimatedBudget Decimal?          @db.Decimal(10, 2)
  contact       Json?
  response      String?
  deadline      DateTime?
  serviceId     String?
  urgency       String?
  requestDate   DateTime?
  responseDate  DateTime?
  status        String              @default("pending")
  isActive      Boolean             @default(true)
  createdAt     DateTime            @default(now())
  updatedAt     DateTime            @updatedAt

  // Relations
  company       companies           @relation(fields: [companyId], references: [id], onDelete: Cascade)

  @@index([companyId])
  @@map("company_advisory")
}


model contenidoMaestro {
  id            String              @id @default(cuid())
  title         String
  tituloOriginal String?
  contenidoOriginal String?
  content       String
  extracto      String?
  type          String
  tipo          String?
  idiomaOrigen  String?
  autorId       String?
  autorNombre   String?
  category      String?
  estado        String?
  metadatos     Json?
  isActive      Boolean             @default(true)
  createdAt     DateTime            @default(now())
  updatedAt     DateTime            @updatedAt

  traducciones  traduccion[]
  publicaciones publicacionComunidad[]

  @@map("contenido_maestro")
}

model traduccion {
  id            String              @id @default(cuid())
  contenidoId   String?
  language      String
  idiomaDestino String?
  key           String
  value         String
  tituloTraducido String?
  contenidoTraducido String?
  extractoTraducido String?
  estadoTraduccion String?
  traducidoPor  String?
  confianzaTraduccion Float?
  createdAt     DateTime            @default(now())
  updatedAt     DateTime            @updatedAt

  contenidoMaestro contenidoMaestro? @relation(fields: [contenidoId], references: [id], onDelete: Cascade)
  publicaciones publicacionComunidad[]

  @@unique([language, key])
  @@map("traducciones")
}

model post {
  id            String              @id @default(cuid())
  title         String
  content       String
  authorId      String
  isActive      Boolean             @default(true)
  createdAt     DateTime            @default(now())
  updatedAt     DateTime            @updatedAt

  @@map("posts")
}

model postComment {
  id            String              @id @default(cuid())
  postId        String
  content       String
  authorId      String
  isActive      Boolean             @default(true)
  createdAt     DateTime            @default(now())
  updatedAt     DateTime            @updatedAt

  @@map("post_comments")
}

model publicacionComunidad {
  id            String              @id @default(cuid())
  contenidoId   String?
  traduccionId  String?
  title         String
  content       String
  authorId      String
  comunidadId   String?
  comunidadSlug String?
  idioma        String?
  slug          String?
  urlPublica    String?
  publicado     Boolean             @default(false)
  fechaPublicacion DateTime?
  isActive      Boolean             @default(true)
  createdAt     DateTime            @default(now())
  updatedAt     DateTime            @updatedAt

  contenidoMaestro contenidoMaestro? @relation(fields: [contenidoId], references: [id], onDelete: Cascade)
  traduccion    traduccion?       @relation(fields: [traduccionId], references: [id], onDelete: SetNull)

  @@map("publicaciones_comunidad")
}

model contact {
  id              String              @id @default(cuid())
  companyLeadId   String?
  companyId       String?
  firstName       String
  lastName        String?
  name            String?
  email           String?
  phone           String?
  position        String?
  department      String?
  linkedin        String?
  notes           String?
  isPrimary       Boolean             @default(false)
  isActive        Boolean             @default(true)
  createdAt       DateTime            @default(now())
  updatedAt       DateTime            @updatedAt

  // Relations
  companyLead     company_leads?      @relation(fields: [companyLeadId], references: [id], onDelete: Cascade)
  company         companies?          @relation(fields: [companyId], references: [id], onDelete: Cascade)
  interactions    lead_interactions[]

  @@map("contacts")
}
